#!/bin/bash

# ┌─────────────────────────────────────────────────┐
# │ File / Version : tool-index / live              │
# │ Author : Mark Hamilton │ Co-Pilot AI assisted   │
# │ Script : Toolbox Index                          │
# │ Package : toolbox                               │
# │ Purpose : toolbox Help tool                     │
# └─────────────────────────────────────────────────┘
# Usage:
#   tool-index [<tool-name>]
# Examples:
#   tool-index
#   tool-index tool-diag
#   tool-index tool-update
# Description:
#   Lists all available tools in the Kali Toolbox with version info.
#   If a tool name is provided, displays its embedded help block.
#   Parses help blocks using (# Usage:) to (# End Help) comment markers.
# End Help

TOOL_DIR="/usr/local/bin"
TOOL_PREFIX="tool-"

if [ -z "$1" ]; then
  echo "Available Tools in Kali Toolbox:"
  for file in $TOOL_DIR/${TOOL_PREFIX}*; do
    name=$(basename "$file")
    purpose=$(grep -m1 "^#.*Script Purpose" "$file" | cut -d':' -f2- | sed 's/^ *//;s/ *$//')
    version=$(grep -m1 "^#.*Version" "$file" | cut -d':' -f2- | sed 's/^ *//;s/ *$//')

    printf "%-15s : %s (Version: %s)\n" "$name" "$purpose" "$version"
  done
  echo -e "\nUse 'tool-index <tool-name>' for detailed help."
else
  target="$TOOL_DIR/$1"
  if [ -f "$target" ]; then
    awk '/┌/,/┘/' "$target"
    echo -e "\nUsage Guide:"
    awk '/^# Usage:/,/^# Examples:/' "$target" | sed 's/^# //'
    echo -e "\nExamples:"
    awk '/^# Examples:/,/^# End Help/' "$target" | sed 's/^# //'
  else
    echo "Tool '$1' not found in $TOOL_DIR."
  fi
fi
