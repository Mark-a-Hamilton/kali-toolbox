#!/bin/bash

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚            kali-update v1.0                â”‚
# â”‚   System hygiene and cleanup wrapper       â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

set -e

LOG=false
DRY_RUN=false
HASHMAP=false

while [[ "$#" -gt 0 ]]; do
    case "$1" in
        --dry-run) DRY_RUN=true ;;
        --log) LOG=true ;;
        --hashmap) HASHMAP=true ;;
        --help)
            echo "Usage: kali-update [--dry-run] [--log] [--hashmap]"
            exit 0 ;;
        *) echo "Unknown option: $1"; exit 1 ;;
    esac
    shift
done

steps=(
    "apt update"
    "apt upgrade -y"
    "apt autoremove -y"
    "apt clean"
)

echo "ğŸ”„ Starting Kali update..."
for step in "${steps[@]}"; do
    if $DRY_RUN; then
        echo "[DRY-RUN] Would execute: $step"
    else
        echo "âœ… Executing: $step"
        eval "$step"
    fi
done

if $LOG && ! $DRY_RUN; then
    echo "ğŸ“ Logging to /var/log/kali-update.log"
    {
        echo "=== kali-update ==="
        date
        for step in "${steps[@]}"; do echo "$step"; done
        echo "==================="
    } >> /var/log/kali-update.log
fi

if $HASHMAP; then
    sha256sum "$0" > .hashmap/kali-update.hash
    date > .hashmap/kali-update.timestamp
fi

echo "ğŸ‰ Update complete."
